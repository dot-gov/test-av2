SYSTEM_FUNCTIONAL_AVMASTER:
    - VM: [ funie, funch, funff ]
    - REVERT
    - SLEEP: [5, 60]

    - START_VM
    - CALL: VM_PUSH_AGENT
    - START_AGENT: 172.20.20.168
    - SET:
        backend: 192.168.100.201
        frontend: 192.168.100.204
    - CALL: VM_CLEAN_EVIDENCES_AND_CACHE
    - UNINSTALL
    - PUSH: [ AVAgent/assets/facebook.bat ]
    - BUILD: [ pull, windows_elite, silent ]
    - EXECUTE_VM: [ /AVTest/build/windows_elite/agent.exe, [], 40, True, True ]
    - SLEEP: 60

    - EXECUTE_VM: [ /AVTest/AVAgent/assets/facebook.bat, [], 40, True, True ]
    - SLEEP: 60
    - EXECUTE_VM: [ /avtest/avagent/assets/keyinject.exe, [], 40, True, True ]
    - SLEEP: 60
    - EXECUTE_VM: [ /avtest/avagent/assets/keyinject.exe, [], 40, True, True ]
    - SLEEP: 120
    - EXECUTE_VM: [ /avtest/avagent/assets/keyinject.exe, [], 40, True, True ]
    - CALL: SET_MAIL
    - REPORT:
        - VM_FUNCTIONAL_EV: ['Functional testing', 'Device']
        - VM_FUNCTIONAL_CHAT_FB: ['Functional testing', 'Social Chat']
        - VM_FUNCTIONAL_ADDRESSBOOK_FB: ['Functional testing', 'Social Addressbook']
        - VM_FUNCTIONAL_EXPLOIT_NOBUILD: ['Functional testing', 'Exploit No Build', INVERT]

SYSTEM_FUNCTIONAL_SOLDIER_AVMASTER:
    - VM: [ funie, funch, funff ]
    - REVERT
    - SLEEP: [5, 60]

    - START_VM
    - CALL: VM_PUSH_AGENT
    - START_AGENT: 172.20.20.168
    - SET:
        backend: 192.168.100.201
        frontend: 192.168.100.204

    - UNINSTALL
    - PUSH: [ AVAgent/assets/facebook.bat ]
    - BUILD: [ pull, windows_soldier, silent ]
    - EXECUTE_VM: [ /AVTest/build/windows-soldier/agent.exe, [], 40, True, True ]
    - SLEEP: 60

    - EXECUTE_VM: [ /AVTest/AVAgent/assets/facebook.bat, [], 40, True, True ]
    - SLEEP: 60
    - EXECUTE_VM: [ /avtest/avagent/assets/keyinject.exe, [], 40, True, True ]
    - SLEEP: 60
    - EXECUTE_VM: [ /avtest/avagent/assets/keyinject.exe, [], 40, True, True ]
    - SLEEP: 60
    - EXECUTE_VM: [ /avtest/avagent/assets/keyinject.exe, [], 40, True, True ]
    - SLEEP: 120
    - EXECUTE_VM: [ /avtest/avagent/assets/keyinject.exe, [], 40, True, True ]
    - CALL: SET_MAIL
    - REPORT:
        - VM_FUNCTIONAL_EV: ['Functional testing', 'Device Soldier']
        - VM_FUNCTIONAL_CHAT_FB: ['Functional testing', 'Social Chat Soldier']
        - VM_FUNCTIONAL_ADDRESSBOOK_FB: ['Functional testing', 'Social Addressbook Soldier']


SYSTEM_FUNCTIONAL_SKYPE_AVMASTER:
    - VM: [ funie ]
    - REVERT

    - START_VM
    - CALL: VM_PUSH_AGENT
    - START_AGENT: 172.20.20.168
    - SET:
        backend: 192.168.100.201
        frontend: 192.168.100.204

    - UNINSTALL
    - CALL: VM_CLEAN_EVIDENCES_AND_CACHE

    - PUSH: [ AVAgent/assets/skype.bat ]
    - BUILD: [ pull, windows_elite, silent ]
    - EXECUTE_VM: [ /AVTest/build/windows_elite/agent.exe, [], 40, True, True ]
    - SLEEP: 60

    - EXECUTE_VM: [ /AVTest/AVAgent/assets/skype.bat, [], 40, True, True ]
    - SLEEP: 300
    - CALL: SET_MAIL

    - REPORT:
        - VM_FUNCTIONAL_EV_SKYPE: ['Functional testing', 'Skype Chat']

VM_SOLDIER_ACHILLE_AVMASTER:
    - BUILD: [ scout, windows, silent ]
    - SLEEP: [60, 90]
    - LIST_DIR: STARTUP_EXE
    - RELOG
    - SET:
        backend: 172.20.20.119
        frontend: 172.20.20.119

    - ON_ERROR: CONTINUE
    - CROP: True

    - BUILD: [ soldier_fast, windows, silent ]
    - LIST_DIR: STARTUP_EXE

    - CROP: False
    - ON_ERROR: SKIP

SYSTEM_SOLDIER_ACHILLE_AVMASTER:
    - VM_ALL
    - INTERNET: False

    - CALL: INIT_DISPATCH
    - SET:
        backend: 172.20.20.119
        frontend: 172.20.20.119
    - CLEAN_EVIDENCES: [ Ok ]

    - SET_SERVER:
        mail_recipients: [zeno@hackingteam.com, seppia@hackingteam.com, m.losito@hackingteam.com]

    - REPORT:
        - VM_SOLDIER_ACHILLE: ['AV Invisibility Experimental', 'Soldier']

    - CALL: VM_GET_LOG
    - CALL: END_DISPATCH


INSTALL_ZEUS:
    - VM: [ z_anon_1, z_anon_2, z_anon_3, z_anon_4, z_conn, z_coll_1, z_coll_2, z_master, z_shard ]
    - STOP_VM
    - CREATE_SNAPSHOT: v9_4
    - REVERT: ready
    - START_VM: NO_CHECK
    - SLEEP: 30

#DANGEROUS loses current status
REVERT_ZEUS:
    - VM: [ z_anon_1, z_anon_2, z_anon_3, z_anon_4, z_conn, z_coll_1, z_coll_2, z_master, z_shard ]
    - STOP_VM
    - REVERT: ready
    - START_VM: NO_CHECK
    - SLEEP: 30

PUSH_ZEUS:
    - VM: [ z_master, z_conn, z_coll_1, z_coll_2, z_shard ]
    - REVERT: ready
    - START_VM: NO_CHECK
    - SLEEP: 60
    - SET_SERVER:
        USERNAME: administrator
        PASSWORD: rcs-test0
    - PUSH: [ assets/rcs-setup-2014093001.exe ]


UPD_AGENT_PUPPET:
    - INTERNET: True
    - SLEEP: [10, 60]
    - REVERT
    - START_VM
    - CHECK_INFECTION # questo non e' necessario, ma e' meglio assicurarsene
    #should be incorporeated in INSTALL_AGENT
    #- CALL: VM_PUSH_AGENT
    - INSTALL_AGENT: 10.1.20.1
    - SLEEP: 60
    - STOP_VM: 300
    - WAIT_SHUTDOWN
    - START_VM: AV_AGENT
    - UNINSTALL
    #- CLEAN_EVIDENCES: [ Ok ]


UPD_AGENT_AND_SNAP_PUPPET:
    - INTERNET: True
    - SLEEP: [10, 60]
    - REVERT
    - START_VM
    - CHECK_INFECTION # questo non e' necessario, ma e' meglio assicurarsene
    #should be incorporeated in INSTALL_AGENT
    #- CALL: VM_PUSH_AGENT
    - INSTALL_AGENT: 10.1.20.1
    - SLEEP: 60
    - STOP_VM: 300
    - WAIT_SHUTDOWN
    - START_VM: AV_AGENT
    - UNINSTALL
    - SLEEP: 60
    - STOP_VM: 300
    - WAIT_SHUTDOWN
    - CALL: UPD_REFRESH
    #- CLEAN_EVIDENCES: [ Ok ]

UPDATE_FULL_PUPPET:
    - VM_ALL
    - ON_ERROR: STOP
    - CALL: SET_MAIL
    - REPORT:
        - UPD_AGENT_PUPPET
        - UPD_WAIT: ['AVM Update', 'Update AV']
        - UPD_REFRESH
    - CALL: END_DISPATCH

